---
title: "SCS Project 1 part 1"
author: "Georgia Ettles, Mayez Haris and Niharika Peddinenikalva"
date: '2022-10-13'
output:
  pdf_document: default
  html_document: default
---

# Introduction

The easySHARE data (https://tinyurl.com/wud2ynbs) is in the form of panel data. This report aims to analyse the data and investigate which risk factors have a significant impact on the participantsâ€™ BMI, and how these risk factors may affect men and women differently. The data was collected in different waves at different points in time, leading to some individuals participating in the study multiple times, and the questions asked were slightly different for each wave. To reduce repeating entries and to simplify the data that was analysed, this report focuses on wave 5 carried out in four countries - Austria, Germany, Netherlands, and Sweden - chosen arbitrarily.

The data has 18749 observations, with 8479 men and 10270 women, and the average participants are aged 66 (since the youngest participant was aged 30). The interviews for cities and suburbs had 28.15% of participants.  32.45% participants have graduated secondary school, 80.5% of the participants are able to make ends meet and 94.45% of the participants live in a household of 4 or fewer members. Also, 66.56% of the participants have 0-2 children. 97.37% participants have higher mobility according to the Activities of Daily living index while 57.99% frequently perform vigorous activities. The average BMI of the participants is 26.62. This is in the overweight range.


```{r setup, echo=FALSE}
knitr::opts_chunk$set(echo = FALSE)
# install.packages(c("ggplot2", "tidyverse", "gridExtra", "countrycode", "visdat"), 
#                 dependencies = TRUE)
suppressPackageStartupMessages(library("tidyverse"))
suppressPackageStartupMessages(library("dplyr"))
suppressPackageStartupMessages(library("gridExtra"))
suppressPackageStartupMessages(library("visdat"))
suppressPackageStartupMessages(library("countrycode"))
```

```{r Load-data}
# Load and store data
load("easySHARE_rel8_0_0(1).rda")
data <- easySHARE_rel8_0_0
```

```{r fix-missing-data}
# Set missing values to NA
data[data < 0] <- NA

# Replace country codes with country names
data$country_mod <- countrycode(factor(data$country_mod), origin = "iso3n", 
                                destination = "country.name")
```


# Modelling

We consider the model below to explore risk factors of obesity:

\begin{align*}
E(Y) = & \beta_0 + \sum_{j=1}^{22} \beta_j x_j + \beta_{10,3} x_{10}x_3 + \beta_{5,1} x_5 x_1 + \beta_{2,15} x_2 x_{15} + \beta_{2,16} x_2 x_{16} \\
& + \beta_{2,19} x_2 x_{19} + \beta_{7,18} x_7 x_{18} + \beta_{7,20} x_7 x_{20} + \beta_{7,21} x_7 x_{21} \\
& + \beta_{12,16} x_{12} x_{16} + \beta_{14,19} x_{14} x_{19} + \beta_{16,1} x_{16} x_1 + \beta_{19,1} x_{19} x_1
\end{align*}

The risk factors are represented by the explanatory variables $x_i$ and described below using the variable name on the easySHARE data guide.

\begin{table}[h!]
\centering
\begin{tabular}{|c|c|p{4cm}|p{6cm}|}
\hline
$x_i$ & \textbf{Variable name} & \textbf{Description of variable}  & \textbf{Possible Values}\\
\hline
$x_1$ & age & Age of participant & range of positive values \\
\hline
$x_2$ & female & Male or female &  Male=0, Female =1 \\
\hline
$x_3$ & dn004\_mod & Born in country of interview &  No=0, Yes=1 \\
\hline
$x_4$ & partnerinhh & Living with spouse/partner &  No=0, Yes=1 \\
\hline
$x_5$ & mother\_alive & Is mother alive? &  No=0, Yes=1 \\
\hline
$x_6$ & father\_alive & Is father alive? &  No=0, Yes=1 \\
\hline
$x_7$ & ever\_smoked & Ever smoked daily? &  No=0, Yes=1 \\
\hline
$x_8$ & hc012\_ & Visited hospital in last 12 months? &  No=0, Yes=1 \\
\hline
$x_9$ & hc029\_ & In a nursing home? &  No=0, Yes=1 \\
\hline
$x_{10}$ & country\_mod & Country identifier &  Name of each country* \\
\hline
$x_{11}$ & iv009\_mod & Area of interview location &  City\_sub = City or suburbs; Town\_rural = Small/Large towns or village \\
\hline
$x_{12}$ & hhsize & Household size &  Up to 4; More than 4 people \\
\hline
$x_{13}$ & eurod & Depression scale of EURO-D &  Not depressed = 0-3, Somewhat depressed = 4-6, Relatively depressed = 7-9, Very depressed = 10-12 \\
\hline
$x_{14}$ & ch001\_ & Number of children alive &  Up to 2 or More than 2 children  \\
\hline
$x_{15}$ & chronic\_mod & Number of chronic diseases &  0; 1-3; 4-7; 8-10 chronic diseases   \\
\hline
$x_{16}$ & adla & Activities of daily living index &  High mobility = 0-2; Low mobility = 3-5\\
\hline
$x_{17}$ & br015\_ & Vigorous activities &  Often = Once a week or more; Rarely = Less than once a week \\
\hline
$x_{18}$ & co007\_ & Is household able to make ends meet? &  With difficulty = some or great difficulty; Relatively easily = fairly easily or easily \\
\hline
$x_{19}$ & br010\_mod & Drinking behaviour &  Rarely = Less than once a month or never; Occasionally = once a month to once or twice a week; Regularly = 3 days a week to almost every day \\
\hline
$x_{20}$ & maxgrip & Maximum of grip strength measure &  Low = Less than or equal to 35; High = greater than 35 \\
\hline
$x_{21}$ & sphus & Self-perceived health &  Good = Excellent/Very good/Good; Not good = Fair/Poor \\
\hline
$x_{22}$ & isced1997\_r & Level of Education completed (ISCED-97 coding) &  Secondary and below; Post secondary; other = Still in school/other \\
\hline

\end{tabular}
\end{table}

Note: $x_2$ to $x_{22}$ are categorical variables while $x_1=$ age is a continuous variable.


```{r Set-lists}
# binary variables
factor_list <- c("female", "dn004_mod",
                 "partnerinhh", "mother_alive", "father_alive", "ever_smoked",
                 "hc012_","hc029_")

# variables with more than two levels
ordered_list <-  c("iv009_mod", "hhsize", "eurod", 
                  "ch001_", "chronic_mod", "adla", "br015_", "co007_", 
                  "br010_mod", "maxgrip", "sphus", "isced1997_r")

# continuous variables
nonfactor_list <- c("age","country_mod")

```

```{r factor-levels}
# Factoring binary variables as dummy variables
for (column in factor_list) {
  if (column != "hc029_") {data[, column] <- ifelse(data[, column] == "1", 1, 0)}
  else {data$hc029_ <- ifelse(data[, column] == "5", 0, 1)}
  data[, column] <- factor(data[, column], levels = c(0,1), labels = c("No", "Yes"))
}


# Factor non-binary variables
for (column in ordered_list) {
  data[, column] <- factor(data[, column])
}

# Simplifying levels for specific variables
levels(data$isced1997_r) <- list("Secondary and Below" = as.character(0:3), 
                                 "Post Secondary" = as.character(4:6), 
                                 "Other" = as.character(95:96))

levels(data$eurod) <- list("Not Depressed" = as.character(0:3), 
                           "Somewhat Depressed" = as.character(4:6), 
                           "Relatively Depressed" = as.character(7:9),
                           "Very Depressed" = as.character(10:12))

levels(data$hhsize) <- list("Up to 4" = as.character(1:4), 
                            "More than 4" = as.character(c(4:12, 14:15)))


levels(data$iv009_mod) <- list("City_sub" = as.character(1:2),
                             "Town_rural" = as.character(3:5))

levels(data$sphus) <- list("Good" = as.character(1:3),
                             "Not Good" = as.character(4:5))

levels(data$ch001_) <- list("Up to 2" = as.character(0:2),
                             "More than 2" = as.character(3:19))

levels(data$chronic_mod) <- list("0" = as.character(0),
                             "1-3" = as.character(1:3),
                             "4-10" = as.character(4:10))

levels(data$adla) <- list("High Mobility" = as.character(0:2),
                                  "Low Mobility" = as.character(3:5))

levels(data$br015_) <- list("Often" = as.character(1:2),
                            "Rarely" =  as.character(3:4))

levels(data$co007_) <- list("With Difficulty" = as.character(1:2),
                                    "Relatively easily" = as.character(3:4))

levels(data$br010_mod) <- list("Rarely" = as.character(1:2),
                                       "Occasionally" = as.character(3:4),
                                       "Regularly" = as.character(5:7))

levels(data$maxgrip) <- list("Low" = as.character(1:35),
                             "High" = as.character(36:99))

```


```{r setting-up-data}
# Setting up data to analyse
working_data <- data %>% 
  filter(wave %in% c(5)) %>%
  filter(country_mod %in% c("Austria", "Germany", "Netherlands", "Sweden")) %>%
  select(all_of(c(factor_list, ordered_list, nonfactor_list)), "bmi")

working_data$country_mod <- factor(working_data$country_mod)

summary(working_data)
```

```{r Box-Plots}

boxplot(bmi ~ country_mod, data = working_data )
par(mfrow = c(1,2))
boxplot(bmi ~ adla, data = working_data)
boxplot(bmi ~ maxgrip, data = working_data)
```

Not: discuss boxplots (20-30 words?)

```{r Model}
mod <- bmi ~ . + country_mod:dn004_mod + mother_alive:age + female:chronic_mod +

  female:adla + female:br010_mod + br015_:age + ever_smoked:co007_ +

  ever_smoked:maxgrip + ever_smoked:sphus + hhsize:adla + ch001_:br010_mod +

  adla:age + br010_mod:age

fit <- lm(mod, data = working_data)

par(mfrow = c(2,2))
plot(fit)
```



Note: Discuss model assumptions here

# Display and interpret models for Males and Females

```{r Sex-model, echo=FALSE}
sex_mod <- bmi ~ . + country_mod:dn004_mod + mother_alive:age + br015_:age + 
  
  ever_smoked:co007_ + adla:age + br010_mod:age +
  
  ever_smoked:maxgrip + ever_smoked:sphus + hhsize:adla + ch001_:br010_mod
```

```{r Sex-model-male, include=FALSE}
male_data <- working_data %>%
  filter(female == "No") %>%
  mutate(female = NULL)
fit_male <- lm(sex_mod, data = na.omit(male_data))
better_male_fit <- step(fit_male)
```


```{r male summary, echo=FALSE}
summary(better_male_fit)
```


```{r Sex-model-female, include=FALSE}
female_data <- working_data %>%
  filter(female == "Yes") %>%
  mutate(female = NULL)
fit_female <- lm(sex_mod, data = na.omit(female_data))
better_female_fit <- step(fit_female)
```


```{r female-summary, echo=FALSE}
summary(better_female_fit)
```

Note: put analysis and tables here

```{r boxplots-analysis}
chronic_plot <- ggplot(na.omit(working_data) %>% select(c(bmi, female, chronic_mod)) %>%
         group_by("female"), 
       aes(y=bmi, x=chronic_mod)) +
  geom_boxplot(aes(fill = female)) +
  scale_fill_discrete(name = "Sex", labels = c("Male", "Female")) 

adla_plot <- ggplot(na.omit(working_data) %>% select(c(bmi, female, adla)) %>%
         group_by("female"), 
       aes(y=bmi, x=adla)) +
  geom_boxplot(aes(fill = female)) +
  scale_fill_discrete(name = "Sex", labels = c("Male", "Female"))

br010_plot <- ggplot(na.omit(working_data) %>% select(c(bmi, female, br010_mod)) %>%
         group_by("female"), 
       aes(y=bmi, x=br010_mod)) +
  geom_boxplot(aes(fill = female)) +
  scale_fill_discrete(name = "Sex", labels = c("Male", "Female")) 

maxgrip_plot <-ggplot(na.omit(working_data) %>% select(c(bmi, female, maxgrip)) %>%
         group_by("female"), 
       aes(y=bmi, x=maxgrip)) +
  geom_boxplot(aes(fill = female)) +
  scale_fill_discrete(name = "Sex", labels = c("Male", "Female")) 

sphus_plot <-ggplot(na.omit(working_data) %>% select(c(bmi, female, sphus)) %>%
         group_by("female"), 
       aes(y=bmi, x=sphus)) +
  geom_boxplot(aes(fill = female)) +
  scale_fill_discrete(name = "Sex", labels = c("Male", "Female")) 

country_plot <-ggplot(na.omit(working_data) %>% select(c(bmi, female, country_mod)) %>%
         group_by("female"), 
       aes(y=bmi, x=country_mod)) +
  geom_boxplot(aes(fill = female)) +
  scale_fill_discrete(name = "Sex", labels = c("Male", "Female")) 

grid.arrange(chronic_plot, adla_plot, br010_plot, maxgrip_plot, sphus_plot, 
             country_plot, nrow = 3)

```